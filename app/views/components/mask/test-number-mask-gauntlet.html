<div class="row top-padding">
  <div class="six columns">
    <h2>Mask Test: Number Mask Gauntlet</h2>
    <p>Related JIRA Tickets: -
      <br/>
    </p>
  </div>
</div>

<div class="row">
  <div class="three columns">
    <div class="field">
      <label for="number-dec">Number: <span class="number">1000.00</span></label>
      <input id="number-dec" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowDecimal": true, "allowThousandsSeparator": false, "integerLimit": 4, "decimalLimit": 2 } }' placeholder="####.00"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="neg-number-dec">Negative Number: <span class="number">-1000.00</span></label>
      <input id="neg-number-dec" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowNegative": true, "allowThousandsSeparator": false, "allowDecimal": true, "integerLimit": 4, "decimalLimit": 2 } }' placeholder="-####.00"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="number">Number: <span class="number">1000</span></label>
      <input id="number" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowThousandsSeparator": false, "allowDecimal": false, "integerLimit": 4 } }' placeholder="####"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="neg-number">Negative Number: <span class="number">-1000</span></label>
      <input id="neg-number" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowThousandsSeparator": false, "allowDecimal": false, "allowNegative": true, "integerLimit": 4 } }' placeholder="-####"/>
    </div>
  </div>
</div>

<div class="row">
  <div class="three columns">
    <div class="field">
      <label for="number-dec-thousands">Number: <span class="number">1,000.00</span></label>
      <input id="number-dec-thousands" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowDecimal": true, "integerLimit": 4, "decimalLimit": 2 } }' placeholder="#,###.00"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="neg-number-dec-thousands">Negative Number: <span class="number">-1,000.00</span></label>
      <input id="neg-number-dec-thousands" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowDecimal": true, "allowNegative": true, "integerLimit": 4, "decimalLimit": 2 } }' placeholder="-#,###.00"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="number-thousands">Number: <span class="number">1,000</span></label>
      <input id="number-thousands" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowDecimal": false, "integerLimit": 4 } }'  placeholder="#,###"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="neg-number-thousands">Negative Number: <span class="number">-1,000</span></label>
      <input id="neg-number-thousands" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowDecimal": false, "allowNegative": true, "integerLimit": 4 } }'  placeholder="-#,###"/>
    </div>
  </div>
</div>

<div class="row">
  <div class="three columns">
    <div class="field">
      <label for="longer-number-dec">Millions: <span class="number">1000000.00</span></label>
      <input id="longer-number-dec" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowThousandsSeparator": false, "allowDecimal": true, "integerLimit": 7, "decimalLimit": 2 } }' placeholder="#######.00"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="neg-longer-number-dec">Negative Millions: <span class="number">-1000000.00</span></label>
      <input id="neg-longer-number-dec" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowThousandsSeparator": false, "allowDecimal": true, "allowNegative": true, "integerLimit": 7, "decimalLimit": 2 } }' placeholder="-#######.00"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="longer-number">Millions: <span class="number">1000000</span></label>
      <input id="longer-number" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowThousandsSeparator": false, "allowDecimal": false, "integerLimit": 7 } }' placeholder="#######"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="neg-longer-number">Negative Millions: <span class="number">-1000000</span></label>
      <input id="neg-longer-number" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowThousandsSeparator": false, "allowDecimal": false, "allowNegative": true, "integerLimit": 7 } }' placeholder="-#######"/>
    </div>
  </div>
</div>

<div class="row">
  <div class="three columns">
    <div class="field">
      <label for="longer-number-dec-thousands">Millions: <span class="number">1,000,000.00</span></label>
      <input id="longer-number-dec-thousands" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowDecimal": true, "integerLimit": 7, "decimalLimit": 2 } }' placeholder="#,###,###.00"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="neg-longer-number-dec-thousands">Negative Millions: <span class="number">-1,000,000.00</span></label>
      <input id="neg-longer-number-dec-thousands" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowDecimal": true, "allowNegative": true, "integerLimit": 7, "decimalLimit": 2 } }' placeholder="-#,###,###.00"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="longer-number-thousands">Millions: <span class="number">1,000,000</span></label>
      <input id="longer-number-thousands" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowDecimal": false, "allowNegative": true, "integerLimit": 7 } }' placeholder="#,###,###"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="neg-longer-number-thousands">Negative Millions: <span class="number">-1,000,000</span></label>
      <input id="neg-longer-number-thousands" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowDecimal": false, "allowNegative": true, "integerLimit": 7 } }' placeholder="-#,###,###"/>
    </div>
  </div>
</div>

<div class="row">
  <div class="three columns">
    <div class="field">
      <label for="way-longer-number-dec">Billions: <span class="number">1000000000.00</span></label>
      <input id="way-longer-number-dec" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowThousandsSeparator": false, "allowDecimal": true, "integerLimit": 10, "decimalLimit": 2 } }' placeholder="##########.00"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="neg-way-longer-number-dec">Negative Billions: <span class="number">-1000000000.00</span></label>
      <input id="neg-way-longer-number-dec" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowThousandsSeparator": false, "allowDecimal": true, "allowNegative": true, "integerLimit": 10, "decimalLimit": 2 } }' placeholder="-##########.00"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="way-longer-number">Billions: <span class="number">1000000000</span></label>
      <input id="way-longer-number" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowThousandsSeparator": false, "allowDecimal": false, "integerLimit": 10 } }' placeholder="##########"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="neg-way-longer-number">Negative Billions: <span class="number">-1000000000</span></label>
      <input id="neg-way-longer-number" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowThousandsSeparator": false, "allowDecimal": false, "allowNegative": true, "integerLimit": 10 } }' placeholder="-##########"/>
    </div>
  </div>
</div>

<div class="row">
  <div class="three columns">
    <div class="field">
      <label for="way-longer-number-dec-thousands">Billions: <span class="number">1,000,000,000.00</span></label>
      <input id="way-longer-number-dec-thousands" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowDecimal": true, "integerLimit": 10, "decimalLimit": 2 } }' placeholder="#,###,###,###.00"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="neg-way-longer-number-dec-thousands">Negative Billions: <span class="number">-1,000,000,000.00</span></label>
      <input id="neg-way-longer-number-dec-thousands" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowDecimal": true, "allowNegative": true, "integerLimit": 10, "decimalLimit": 2 } }' placeholder="-#,###,###,###.00"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="way-longer-number-thousands">Billions: <span class="number">1,000,000,000</span></label>
      <input id="way-longer-number-thousands" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowDecimal": false, "integerLimit": 10 } }' placeholder="#,###,###,###"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="neg-way-longer-number-thousands">Negative Billions: <span class="number">-1,000,000,000</span></label>
      <input id="neg-way-longer-number-thousands" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowDecimal": false, "allowNegative": true, "integerLimit": 10 } }' placeholder="-#,###,###,###"/>
    </div>
  </div>
</div>

<div class="row">
  <div class="three columns">
    <div class="field">
      <label for="max-number-dec">Quintillion: <span class="number">(18, 6)</span></label>
      <input id="max-number-dec" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowDecimal": true, "allowThousandsSeparator": true, "integerLimit": 18, "decimalLimit": 6 } }' placeholder="###,###,###,###,###,###.000000"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="max-neg-number-dec">Negative Quintillion: <span class="number">Minus (18, 6)</span></label>
      <input id="max-neg-number-dec" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowNegative": true, "allowThousandsSeparator": true, "allowDecimal": true, "integerLimit": 18, "decimalLimit": 6 } }' placeholder="-###,###,###,###,###,###.000000"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="max-number">Quintillion: <span class="number">(18) Digits</span></label>
      <input id="max-number" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowThousandsSeparator": true, "allowDecimal": false, "integerLimit": 18 } }' placeholder="##################"/>
    </div>
  </div>
  <div class="three columns">
    <div class="field">
      <label for="max-neg-number">Negative Quintillion: <span class="number">Minus (18) Digits</span></label>
      <input id="max-neg-number" inputmode="numeric" data-init="false" class="new-mask" data-options='{ "patternOptions": { "allowThousandsSeparator": true, "allowDecimal": false, "allowNegative": true, "integerLimit": 18 } }' placeholder="-##################"/>
    </div>
  </div>
</div>

<script>
  $('body').on('initialized', function() {
    // Base options that get used by everything
    var opts = {
      process: 'number',
      patternOptions: {
        symbols: {
          thousands: Soho.Locale.currentLocale.data.numbers.group,
          decimal: Soho.Locale.currentLocale.data.numbers.decimal,
          negative: Soho.Locale.currentLocale.data.numbers.minusSign
        }
      }
    };

    var thisLocale = Soho.Locale.currentLocale,
      localeString = thisLocale.name,
      isLocalized = localeString !== 'en-US'; // default for the test suite

    $('input.new-mask').each(function() {
      // Invoke the mask component
      var dataOpts = JSON.parse( $(this).attr('data-options') );
      if (dataOpts.patternOptions) {
        dataOpts.patternOptions.symbols = opts.patternOptions.symbols;
      }
      var thisOpts = $.extend({}, opts, dataOpts);
      $(this).mask(thisOpts);

      // When not using the `en-US` locale, localize the label and placeholder
      if (isLocalized) {
        var localizedLabelOpts = {
          locale: thisLocale.name,
          group: thisOpts.patternOptions.symbols.thousands,
          decimal: thisOpts.patternOptions.symbols.decimal,
          minusSign: thisOpts.patternOptions.symbols.negative,
          minimumFractionDigits: 0
        };

        // Detect the label's contents from the page
        var numberSpan = $(this).prev('label').find('.number');
        var spanText = numberSpan.text();

        // Update quintillion text
        if (spanText.indexOf('18') > -1) {
          var quintillion = {
            '(18, 6)': '100,000,000,000,000,000.000000',
            'Minus (18, 6)': '-100,000,000,000,000,000.000000',
            '(18) Digits': '100000000000000000',
            'Minus (18) Digits': '-100000000000000000',
          }
          spanText = quintillion[spanText];
        }

        // Check for thousands separators and decimals inside the label span
        var thousandsRegex = new RegExp(',', 'g');
        var hasThousands = thousandsRegex.test(spanText);
        var preparedLabelText = spanText.toString()
          .replace(thousandsRegex, '')
          .replace('.', localizedLabelOpts.decimal);

        // Additional settings based on what we get
        if (!hasThousands) {
          localizedLabelOpts.groupSizes = [0, 0];
        }
        if (thisOpts.patternOptions.decimalLimit) {
          localizedLabelOpts.minimumFractionDigits = thisOpts.patternOptions.decimalLimit;
          localizedLabelOpts.maximumFractionDigits = thisOpts.patternOptions.decimalLimit;
        }

        // Get all locale-formatted values
        var number = Soho.Locale.parseNumber(preparedLabelText, localizedLabelOpts);
        var formattedSpanText = Soho.Locale.formatNumber(number, localizedLabelOpts);
        var placeholderText = formattedSpanText.replace(/\d/g, '#');

        // Put them back in
        numberSpan.text(formattedSpanText);
        $(this).attr('placeholder', placeholderText);
      }
    });
  });

</script>
