<section id="maincontent" class="composite-form scrollable-flex" role="main">
  <section class="scrollable-flex-header expandable-area is-expanded">
    <div class="expandable-pane">
      <div class="content">
        <div class="row">
          <div class="twelve columns">
            <hr class="fieldset-hr"/>
            <h1 class="fieldset-title">Sample Fields</h1>
          </div>
        </div>

        <form id="example-mulitcolumn-form">
          <div class="row demo-grid">
            <div class="full column">

              <div class="compound-field">

                <div class="field">
                  <label for="example-mulitcolumn-first" class="required">First Name</label>
                  <input type="text" id="example-mulitcolumn-first" name="first-name" aria-required="true" data-validate="required"/>
                </div>

                <div class="field">
                  <label for="example-mulitcolumn-last" class="required">Last Name</label>
                  <input type="text" id="example-mulitcolumn-last" class="input-sm" name="last-name" aria-required="true" data-validate="required"/>
                </div>

                <div class="field">
                  <input type="checkbox" class="checkbox" id="prefered" checked="true"/>
                  <label for="prefered" class="prefered-label">Prefered</label>
                </div>

              </div>

              <div class="compound-field">

                <div class="field">
                  <label for="example-mulitcolumn-phone" class="required">Phone</label>
                  <input type="text" aria-required="true" data-validate="required" id="example-mulitcolumn-phone" class="input-sm" name="phone"/>
                </div>

                <div class="field">
                  <label for="example-mulitcolumn-ext">Ext</label>
                  <input type="text" id="example-mulitcolumn-ext" class="input-xs" name="ext"/>
                </div>

                <div class="field">
                  <label for="cpf-input-unit" class="label">Unit</label>
                  <input type="text" id="cpf-input-unit" name="cpf-input-unit" class="input-sm"/>
                </div>

                <div class="field">
                  <label for="cpf-input-units" class="audible label">Units</label>
                  <span class="label">&nbsp;</span>
                  <select id="cpf-input-units" name="cpf-input-units"  class="dropdown dropdown-xs">
                  <option value="KG">KG</option>
                  <option value="M">M</option>
                  <option value="P">%</option>
                  </select>
                </div>

              </div>

              <div class="compound-field">
                <div class="field">
                  <label for="cpf-input-setting" class="label">Setting</label>
                  <input type="text" id="cpf-input-setting"/>
                </div>
                <div class="switch field">
                  <input class="switch" type="checkbox" id="cpf-switch-setting"/>
                  <label for="cpf-switch-setting"/>
                </div>
              </div>

              <button type="submit" class="btn-primary">Register</button>

            </div>

          </div>
        </form>
      </div>
    </div>
  </section>
  <section class="scrollable-flex-content no-scroll">
    <div class="tab-container vertical no-scroll" data-options='{ "verticalResponsive": true }'>
      <div class="tab-list-container scrollable-y">
        <ul class="tab-list">
          <li class="tab"><a id="detail" href="#composite-form-detail">Detail</a></li>
          <li class="tab"><a id="options" href="#composite-form-grid">Grid</a></li>
          <li class="tab is-disabled"><a id="quantity_detail" href="#composite-form-quantity-detail">Quantity Detail</a></li>
          <li class="tab is-disabled"><a id="user-fields" href="#composite-form-user-fields">User Fields</a></li>
          <li class="tab is-selected"><a id="messages" href="#composite-form-cards-pie">Chart & Cards</a></li>
          <li class="tab"><a id="add-on-changes" href="#composite-form-addon-changes">Add-On Changes</a></li>
        </ul>
      </div>
    </div>
    <div class="tab-panel-container scrollable-y">
      <div id="composite-form-detail" class="tab-panel" role="tabpanel">
        {{> components/compositeform/_detail}}
      </div>
      <div id="composite-form-grid" class="tab-panel" role="tabpanel">
        <div class="row">
          <div class="twelve columns">
            <div role="toolbar" class="toolbar">

              <div class="title">
                Data Grid Header Title
                <span class="datagrid-result-count">(N Results)</span>
              </div>

              <div class="buttonset">
                  <button type="button" id="toggle-row-status" class="btn">
                    <span>Add Row Status</span>
                  </button>
                  <button type="button" id="validate" class="btn-menu">
                    <span>Validate</span>
                  </button>
                  <ul class="popupmenu">
                    <li><a href="#" data-action="specific-row-error">Specific Row Error</a></li>
                    <li><a href="#" data-action="all-cells-in-row">All Cells in Row</a></li>
                    <li><a href="#" data-action="all-rows-and-cells">All Rows and Cells</a></li>
                    <li class="separator"></li>
                    <li><a href="#" data-action="clear-specific-row-error">Clear Specific Row Error</a></li>
                    <!-- <li><a href="#" data-action="clear-all-cells-in-row">Clear All Cells in Row</a></li> -->
                    <li><a href="#" data-action="clear-all-rows-and-cells">Clear All Rows and Cells</a></li>
                  </ul>
                <button class="btn-icon" type="button" id="add-btn">
                  <svg class="icon" focusable="false" aria-hidden="true" role="presentation">
                    <use href="#icon-add"></use>
                  </svg>
                  <span class="audible">Add</span>
                </button>
                <button class="btn" type="button" id="clearDirtyRows-btn">
                  <span class="audible">Clear Dirty Row</span>
                </button>
              </div>

              <div class="more">
                <button class="btn-actions" type="button">
                  <svg class="icon" focusable="false" aria-hidden="true" role="presentation">
                    <use href="#icon-vertical-ellipsis"></use>
                  </svg>
                  <span class="audible">More Actions</span>
                </button>
                <ul class="popupmenu">
                  <li class="single-selectable-section"></li>
                  <li class="heading">Row Height</li>
                  <li class="is-selectable"><a data-option="row-extra-small" href="#" data-translate="text">ExtraSmall</a></li>
                  <li class="is-selectable"><a data-option="row-small" href="#" data-translate="text">Small</a></li>
                  <li class="is-selectable"><a data-option="row-medium" href="#" data-translate="text">Medium</a></li>
                  <li class="is-selectable is-checked"><a data-option="row-large" href="#" data-translate="text">Large</a></li>
                </ul>

              </div>
            </div>

            <div class="contextual-toolbar toolbar is-hidden">
              <div class="title selection-count">0 Selected</div>
              <div class="buttonset">
                <button class="btn-icon" type="button" id="remove-btn">
                  <svg class="icon" focusable="false" aria-hidden="true" role="presentation">
                    <use href="#icon-delete"></use>
                  </svg>
                  <span class="audible">Remove</span>
                </button>
              </div>
            </div>

            <div id="datagrid"></div>
          </div>
        </div>
      </div>
      <div id="composite-form-quantity-detail" class="tab-panel" role="tabpanel">
        <div class="row">
          <div class="twelve columns">
            <h3>Quantity Detail</h3>
          </div>
        </div>
      </div>
      <div id="composite-form-cards-pie" class="tab-panel" role="tabpanel">
        <div class="row">
          <div class="twelve columns">
            <div class="one-third column">
              <div class="card">
                <div class="card-header">
                    <h2 class="widget-title">Card Title</h2>
                    <button class="btn-actions" type="button" id="btn-1">
                      <span class="audible">Actions</span>
                      <svg class="icon" focusable="false" aria-hidden="true" role="presentation">
                        <use href="#icon-vertical-ellipsis"></use>
                      </svg>
                    </button>
                    <ul class="popupmenu">
                      <li><a href="#" id="action-1">Action 1</a></li>
                      <li><a href="#" id="action-2">Action 2</a></li>
                      <li><a href="#" id="action-3">Action 3</a></li>
                      <li><a href="#" id="action-4">Action 4</a></li>
                      <li><a href="#" id="action-5">Action 5</a></li>
                      <li><a href="#" id="action-6">Action 6</a></li>
                      <li><a href="#" id="action-7">Action 7</a></li>
                      <li><a href="#" id="action-8">Action 8</a></li>
                      <li><a href="#" id="action-9">Action 9</a></li>
                      <li><a href="#" id="action-10">Action 10</a></li>
                      <li><a href="#" id="action-11">Action 11</a></li>
                      <li><a href="#" id="action-12">Action 12</a></li>
                    </ul>

                </div>
                <div class="card-content">

                </div>
              </div>
            </div>
            <div class="two-thirds column">
              <div class="widget">
                <div class="widget-header">
                  <h2 class="widget-title">Pie Chart Title</h2>
                </div>
                <div class="widget-content">
                  <div id="pie-chart-example" class="chart-container">
                  </div>
                </div>
              </div>
            </div>
          <div>
        </div>
      </div>
      <div id="composite-form-messages" class="tab-panel" role="tabpanel">
        <div class="row">
          <div class="twelve columns">
            <h3>Messages</h3>
          </div>
        </div>
      </div>
      <div id="composite-form-addon-changes" class="tab-panel" role="tabpanel">
        <div class="row">
          <div class="twelve columns">
            <h3>Add-On Changes</h3>
          </div>
        </div>
      </div>
    </div>
  </section>
</section>

<script>
  var gridApi = null;

  $('body').one('initialized', function () {
    var pieData = [{
      data: [{
          name: 'Item A',
          value: 10.1,
          id: 'item-a',
          attributes: [
            { name: 'id', value: 'item-a' },
            { name: 'data-automation-id', value: 'item-a-automation-id' }
          ],
          tooltip: 'Item A <b>{{percent}}</b>'
      }, {
          name: 'Item B',
          value: 12.2,
          id: 'item-b',
          attributes: [
            { name: 'id', value: 'item-b' },
            { name: 'data-automation-id', value: 'item-b-automation-id' }
          ],
          tooltip: 'Item B <b>{{percent}}</b>'
      }, {
          name: 'Item C',
          value: 14.35,
          id: 'item-c',
          attributes: [
            { name: 'id', value: 'item-c' },
            { name: 'data-automation-id', value: 'item-c-automation-id' }
          ],
          tooltip: 'Item C <b>{{percent}}</b>'
      }, {
          name: 'Item D',
          value: 15.6,
          id: 'item-d',
          attributes: [
            { name: 'id', value: 'item-d' },
            { name: 'data-automation-id', value: 'item-d-automation-id' }
          ],
          tooltip: 'Item D <b>{{percent}}</b>'
      }, {
          name: 'Item E',
          value: 21.6,
          id: 'item-e',
          attributes: [
            { name: 'id', value: 'item-e' },
            { name: 'data-automation-id', value: 'item-e-automation-id' }
          ],
          tooltip: 'Item E <b>{{percent}}</b>'
      }, {
          name: 'Item F',
          value: 41.6,
          id: 'item-f',
          id: 'item-f',
          attributes: [
            { name: 'id', value: 'item-f' },
            { name: 'data-automation-id', value: 'item-f-automation-id' }
          ],
          tooltip: 'Item F <b>{{percent}}</b>'
      }]
    }];

    $('#pie-chart-example').chart({type: 'pie', dataset: pieData})
    .on('selected', function(e, args) {
      if (args[0] && args[0].data) {
        console.log(args[0].data, args[0].data.url);
      }
    });

    var grid,
      columns = [],
      data = [];

    var isDisabled = function(row, cell, value, item) {
      return (row % 2 === 0);
    }

    var newDate = new Date();
    let year = new Intl.DateTimeFormat('en', { year: 'numeric' }).format(newDate);
    let month = new Intl.DateTimeFormat('en', { month: 'numeric' }).format(newDate);
    let day = new Intl.DateTimeFormat('en', { day: '2-digit' }).format(newDate);
    console.log(`${month}-${day}-${year}`);

    // Some Sample Data
    data.push({ id: 1, productId: 2142201, productName: 'Compressor', activity: '<svg/onload=alert(1)>', quantity: 1, price: 210.99, status: 'OK', orderDate: '00000000', portable: false, action: 1, description: 'Compressor comes with various air compressor accessories, to help you with a variety of projects. All fittings are with 1/4 NPT connectors. The kit has an air blow gun that can be used for cleaning'});
    data.push({ id: 2, productId: 2241202, productName: 'console.log', activity: 'Inspect and Repair', quantity: 2, price: 210.991, status: '', orderDate: '', portable: false, action: 1, description: 'The kit has an air blow gun that can be used for cleaning'});
    data.push({ id: 3, productId: 2342203, productName: 'Portable Compressor', activity: '', portable: true, quantity: null, price: 120.992, status: null, orderDate: new Date(2014, 6, 3), action: 2});
    data.push({ id: 4, productId: 2445204, productName: 'Another Compressor', activity: 'Assemble Paint', portable: true, quantity: 3, price: null, status: 'OK', orderDate: new Date(2015, 3, 3), action: 3, description: 'Compressor comes with with air tool kit'});
    data.push({ id: 5, productId: 2542205, productName: 'De Wallt Compressor', activity:  'Inspect and Repair', portable: false, quantity: 4, price: 210.99, status: 'OK', orderDate: new Date(2015, 5, 5), action: 1});
    data.push({ id: 6, productId: 2642205, productName: 'Air Compressors', activity: 'Inspect and Repair', portable: false, quantity: 41, price: 120.99, status: 'OK', orderDate: new Date(2014, 6, 9), action: 2});
    data.push({ id: 7, productId: 2642206, productName: 'Some Compressor', activity: 'inspect and Repair', portable: true, quantity: 41, price: 123.99, status: 'OK', orderDate: new Date(2014, 6, 9), action: 2});

    //Define Columns for the Grid.
    // columns.push({ id: 'rowStatus', sortable: false, resizable: false, formatter: Formatters.Status, align: 'center'});
    columns.push({ id: 'selectionCheckbox', sortable: false, resizable: false, formatter: Formatters.SelectionCheckbox, align: 'center'});
    columns.push({ id: 'id', name: 'Row Id', field: 'id', formatter: Formatters.Readonly});
    columns.push({ id: 'productName', name: 'Product Name', sortable: false, field: 'productName', formatter: Formatters.Hyperlink, editor: Editors.Input});
    columns.push({ id: 'activity', name: 'Activity', field: 'activity', required: true, editor: Editors.Input, validate: 'required'});  //maxLength: 2
    columns.push({ id: 'quantity', name: 'Quantity', field: 'quantity', align: 'right', editor: Editors.Input, mask: '###', isEditable: isDisabled});
    columns.push({ id: 'portable', name: 'Portable', field: 'portable', align: 'center', formatter: Formatters.Checkbox, editor: Editors.Checkbox});
    columns.push({ id: 'price', name: 'Price', field: 'price', align: 'right', formatter: Formatters.Decimal, validate: 'required', numberFormat: {minimumFractionDigits: 3, maximumFractionDigits: 3}, editor: Editors.Input});
    columns.push({ id: 'orderDate', name: 'Order Date', field: 'orderDate', formatter: Formatters.Date, editor: Editors.Date, editorOptions: {
      showLegend: true, legend:
      [{name: 'Weekend', color: '#579E95', dayOfWeek: [0,6]}],
      disable: { years: [], dates: [], minDate: '01-01-2014', maxDate: `${month}-${day}-${year}`,
      dayOfWeek: [],
      isEnable: false,
      restrictMonths: false },
      showTime: false,
      showMonthYearPicker: true,
      placeholder: true,
      incrementWithKeyboard: true,
      todayWithKeyboard: true},
      validate: 'availableDate required date', width: 120
    });
    columns.push({ id: 'action', name: 'Action', field: 'action', formatter: Formatters.Dropdown, editor: Editors.Dropdown, validate: 'required', isEditable: isDisabled,
    options: [{id: '', label: '', value: -1}, {id: 'oh1', label: 'On Hold', value: 1}, {id: 'sh1', label: 'Shipped', value: 2} , {id: 'ac1', label: 'Action', value: 3}, {id: 'pen', label: 'Pending', value: 4}, {id: 'bk1', label: 'Backorder', value: 5}, {id: 'can', label: 'Cancelled', value: 6}, {id: 'pro', label: 'Processing', value: 7}]
    });

    //Init and get the api for the grid
    grid = $('#datagrid').datagrid({
      columns: columns,
      dataset: data,
      editable: true,
      showNewRowIndicator: false,
      clickToSelect: false,
      selectable: 'multiple',
      toolbar: {title: 'Data Grid Header Title', results: true, personalize: true, actions: true, rowHeight: true, keywordFilter: true,  collapsibleFilter: true},
      paging: true,
      pagesize: 5,
      pagesizes: [2, 5, 6],
      trimSpaces: true,
      columnReorder: true,
      showDirty: true
    }).on('cellchange', function (e, args) {
      console.log('cellchange', args);
    }).on('rowadd', function (e, args) {
      console.log(e, args);
    }).on('rowremove', function (e, args) {
      console.log(e, args);
    }).on('dblclick', function (e, args) {
      console.log('dblclick', args);
    });

    gridApi = $('#datagrid').data('datagrid');

    //Example row status
    $('#toggle-row-status').on('click', function () {
      var btn = $(this).find('span');
      var status = {
        add: 'Add Row Status',
        remove: 'Remove Row Status'
      };
      if (btn.text() === status.add) {
        btn.text(status.remove);
        gridApi.rowStatus(0, 'error', 'Error');
        gridApi.rowStatus(0, 'error', 'Error 2');
        gridApi.rowStatus(0, 'error', 'Error 3');
        gridApi.rowStatus(1, 'alert', 'Alert');
        gridApi.rowStatus(2, 'info', 'Info');
        gridApi.rowStatus(3, 'in-progress', 'inProgress');
        gridApi.rowStatus(4, 'success', 'Confirm');
        gridApi.rowStatus(6, 'new', 'new');
        gridApi.rowStatus(6, 'error', 'This row has errors');
      } else {
        btn.text(status.add);
        gridApi.resetRowStatus();
      }
    });

    window.data = data;
  });

  var newId = 8;
  //Add Code for Add and icon-delete
  $('#add-btn').on('click', function () {
    gridApi.addRow({ id: newId++, productId: 2642206, productName: 'New Product'});
    console.log(gridApi.settings.dataset[1]);
  });

  //Add Code for Add and icon-delete
  $('#remove-btn').on('click', function () {
    gridApi.removeSelected();
  });

  $('#clearDirtyRows-btn').on('click', function() {
    gridApi.clearDirty();
  })

  //A few other ways
  $('#validate').on('selected', function (e, args) {
    var action = args.attr('data-action');

    if (action === 'specific-row-error') {
      gridApi.showRowError(2, 'This row has a custom error message.', 'error');
    }
    if (action === 'all-cells-in-row') {
      gridApi.validateRow(2);
    }
    if (action === 'all-rows-and-cells') {
      gridApi.validateAll();
    }
    if (action === 'clear-specific-row-error') {
      gridApi.clearRowError(2);
    }
    if (action === 'clear-all-rows-and-cells') {
      gridApi.clearAllErrors();
    }
  });

</script>
