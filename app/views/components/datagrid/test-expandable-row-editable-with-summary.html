<div class="row">
  <div class="two columns">
    <div class="field">
      <label for="dd-rows" class="label">Row</label>
      <select id="dd-rows" name="dd-rows" class="dropdown dropdown-sm"></select>
    </div>
    <div class="field">
      <button type="button" id="update-row" class="btn-secondary"><span>Update Row</span></button>
    </div>
  </div>
  <div class="two columns">
    <div class="field">
      <label for="dd-qty" class="label">Quantity</label>
      <input id="dd-qty" name="dd-qty" class="input-sm" placeholder="###" data-mask data-options='{ "pattern" : "###", "mode": "number" }'/>
    </div>
  </div>
  <div class="two columns">
    <div class="field">
      <label for="dd-price" class="label">Price</label>
      <input id="dd-price" name="dd-price" class="input-sm" placeholder="###.##" data-mask data-options='{ "pattern" : "###.##", "mode": "number" }'/>
    </div>
  </div>
</div>

<div class="row top-padding">
  <div class="twelve columns">
    <div id="datagrid">
    </div>
  </div>
</div>

{{={{{ }}}=}}

<script>
  $('body').one('initialized', function () {

      var grid;

      var columns = [{
        id: 'productId',
        name: 'Product Id',
        field: 'productId',
        sortable: false,
        filterType: 'text',
        formatter: Soho.Formatters.Expander,
      },
      {
        id: 'productName',
        name: 'Product Name',
        field: 'productName',
        sortable: false,
        filterType: 'text',
        filterConditions: ['equals', 'contains'],
        width: 150,
        formatter: Soho.Formatters.Hyperlink,
      },
      {
        id: 'activity',
        name: 'Activity',
        field: 'activity',
        sortable: false,
        filterType: 'text',
        hidden: true,
      },
      {
        id: 'quantity',
        name: 'Quantity',
        field: 'quantity',
        sortable: false,
        filterType: 'integer',
        formatter: Soho.Formatters.Integer,
        editor: Soho.Editors.Input,
        summaryRowFormatter: Soho.Formatters.SummaryRow, aggregator: 'sum', summaryText: ' ', summaryTextPlacement: 'after'
      },
      {
        id: 'price',
        name: 'Price',
        field: 'price',
        sortable: false,
        filterType: 'decimal',
        formatter: Soho.Formatters.Decimal,
        editor: Soho.Editors.Input,
        summaryRowFormatter: Soho.Formatters.SummaryRow, aggregator: 'sum', summaryText: ' ', summaryTextPlacement: 'after'
      },
      {
        id: 'orderDate',
        name: 'Order Date',
        field: 'orderDate',
        sortable: false,
        filterType: 'date',
        formatter: Soho.Formatters.Date,
        dateFormat: 'M/d/yyyy',
        hidden: true
      }];

      var data = [
        {
          id: 0,
          productId: 214220,
          productName: 'Compressor 1',
          activity: 'Assemble Paint',
          quantity: 1,
          price: 210.99,
          status: 'Active',
          orderDate: '2015-01-01T06:00:00.000Z',
          action: 'Action',
          rated: 0.32,
        },
        {
          id: 1,
          productId: 214221,
          productName: 'Compressor 2',
          activity: 'Assemble Paint',
          quantity: 7,
          price: 209.99,
          status: 'Late',
          orderDate: '2015-01-02T06:00:00.000Z',
          action: 'Action',
          rated: 0.76,
        },
        {
          id: 2,
          productId: 214222,
          productName: 'Compressor 3',
          activity: 'Assemble Paint',
          quantity: 2,
          price: 208.99,
          status: 'Active',
          orderDate: '2015-01-03T06:00:00.000Z',
          action: 'Action',
          rated: 0.32,
        },
        {
          id: 3,
          productId: 214223,
          productName: 'Compressor 4',
          activity: 'Assemble Paint',
          quantity: 2.5,
          price: 207.99,
          status: 'Inactive',
          orderDate: '2015-01-04T06:00:00.000Z',
          action: 'Action',
          rated: 0.53,
        },
        {
          id: 4,
          productId: 214224,
          productName: 'Compressor 5',
          activity: 'Assemble Paint',
          quantity: 3,
          price: 206.99,
          status: 'Inactive',
          orderDate: '2015-01-05T06:00:00.000Z',
          action: 'Action',
          rated: 0.42,
        },
        {
          id: 5,
          productId: 214225,
          productName: 'Compressor 6',
          activity: 'Assemble Paint',
          quantity: 3.5,
          price: 205.99,
          status: 'Inactive',
          orderDate: '2015-01-06T06:00:00.000Z',
          action: 'Action',
          rated: 0.88,
        },
        {
          id: 6,
          productId: 214226,
          productName: 'Compressor 7',
          activity: 'Assemble Paint',
          quantity: 4,
          price: 204.99,
          status: 'Active',
          orderDate: '2015-01-07T06:00:00.000Z',
          action: 'Action',
          rated: 0.54,
        },
        {
          id: 7,
          productId: 214227,
          productName: 'Compressor 8',
          activity: 'Assemble Paint',
          quantity: 4.5,
          price: 203.99,
          status: 'On Hold',
          orderDate: '2015-01-08T06:00:00.000Z',
          action: 'Action',
          rated: 0.41,
        },
        {
          id: 8,
          productId: 214228,
          productName: 'Compressor 9',
          activity: 'Assemble Paint',
          quantity: 5,
          price: 202.99,
          status: 'On Hold',
          orderDate: '2015-01-09T06:00:00.000Z',
          action: 'Action',
          rated: 0.21,
        },
        {
          id: 9,
          productId: 214229,
          productName: 'Compressor 10',
          activity: 'Assemble Paint',
          quantity: 5.5,
          price: 201.99,
          status: 'Late',
          orderDate: '2015-01-10T06:00:00.000Z',
          action: 'Action',
          rated: 0.23,
        },
        {
          id: 10,
          productId: 214230,
          productName: 'Compressor 11',
          activity: 'Assemble Paint',
          quantity: 6,
          price: 200.99,
          status: 'Late',
          orderDate: '2015-01-01T06:00:00.000Z',
          action: 'Action',
          rated: 0.76,
        }
      ];

      var rowTemplate = `<div class="field four columns">
                          <label class="details-field-header">Quantity</label>
                          <p class="details-field-value">{{quantity}}</p>
                        </div>
                        <div class="field four columns">
                          <label class="details-field-header">Price</label>
                          <p class="details-field-value">{{price}}</p>
                        </div>`;

      // Init and get the api for the grid
      grid = $('#datagrid').datagrid({
        columns: columns,
        idProperty:'officeId',
        editable: true,
        dataset: data,
        summaryRow: true,
        rowTemplate: rowTemplate,
        onPostRenderCell: function(container, args) {
          console.log('Post Render Row', args.row, args.value.id, args.value.taskName);
          if (args.row !== 0) {
            container.innerHTML = '<span style="font-weight: bold">' + (args && args.value && args.value.id ? args.value.id : '').toString() + '</span>';
          } else {
            container.innerHTML = (args && args.value && args.value.id ? args.value.id : '').toString();
          }
        },
        attributes: [{ name: 'id', value: 'custom-id' }, { name: 'data-automation-id', value: 'custom-automation-id' } ],
        toolbar: {title: 'Data Grid Header Title', collapsibleFilter: true,
          results: true, keywordFilter: true, actions: true, exportToExcel: true, exportToCsv: true, rowHeight: true, personalize: true}
      });

      grid.on('expandrow', function (e, args) {
        console.log('expandrow', args);
      });

      grid.on('collapserow', function (e, args) {
        console.log('collapserow', args);
      });

      var dropdownEl = $('#dd-rows');
      var gridApi = grid.data('datagrid');

      if (gridApi) {
        var getOptionText = function (idx) {
          var node = gridApi.settings.dataset[idx];
          var optionText = 'Row: ' + idx;

          return optionText;
        };
        var itemsHtml = '';
        for (var i = 0, l = gridApi.settings.dataset.length; i < l; i++) {
          itemsHtml += '<option value="'+ i +'">'+ getOptionText(i) +'</option>';
        }
        dropdownEl.append(itemsHtml).trigger('updated');
      }

      $('#update-row').click(function () {
      if (gridApi) {
        var row = parseInt(dropdownEl.val(), 10);
        var rowData = gridApi.settings.dataset[row];
        var qty = $('#dd-qty').val();
        var price = $('#dd-price').val();
        if (rowData) {
          rowData.quantity = qty ? qty : rowData.quantity;
          rowData.price = price ? price : rowData.price;
          gridApi.updateRow(row, rowData);
          gridApi.toggleRowDetail(row, true);
          console.log('Row is updated');
        } else {
          console.log('Can not find given row to update');
        }
      }
    });

});

</script>
